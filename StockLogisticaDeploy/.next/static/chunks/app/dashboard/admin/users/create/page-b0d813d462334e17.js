(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[215],{457:(e,t,a)=>{"use strict";a.d(t,{l:()=>i,m:()=>c});var s=a(2109),r=a.n(s);let n=[{id:1,username:"admin",password:"admin123",role:"admin",active:!0,email:"",applicationName:"StockLogistica"},{id:2,username:"juan",password:"juan123",role:"user",active:!0,email:"",applicationName:"StockLogistica"}],l="users_secure",o="claveSegura123456";function i(){let e=localStorage.getItem(l);if(!e)return[...n];try{let t=r().AES.decrypt(e,o).toString(r().enc.Utf8);return JSON.parse(t)}catch(e){return console.warn("❌ Error al desencriptar usuarios, se cargan los iniciales"),[...n]}}function c(e){var t;let a=(t=JSON.stringify(e),r().AES.encrypt(t,o).toString());localStorage.setItem(l,a)}},477:()=>{},3637:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),r=a(2115),n=a(5695),l=a(457),o=a(5471),i=a(9576);function c(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)({username:"",password:"",role:"user",active:!0,email:"",applicationName:""}),{user:c}=(0,i.A)(),{hasPermission:u}=(0,o.J)();(0,r.useEffect)(()=>{if(!c){e.push("/login");return}u("canCreateUsers")||e.push("/dashboard")},[c]);let m=e=>{let{name:t,value:s,type:r}=e.target;if("checkbox"===r){let s=e.target.checked;a(e=>({...e,[t]:s}))}else a(e=>({...e,[t]:s}))};return(0,s.jsxs)("div",{className:"max-w-xl mx-auto p-6 bg-white shadow-md rounded",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Crear Nuevo Usuario"}),(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Usuario"}),(0,s.jsx)("input",{name:"username",value:t.username,onChange:m,className:"w-full border rounded px-3 py-2 mb-4"}),(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Contrase\xf1a"}),(0,s.jsx)("input",{name:"password",type:"password",value:t.password,onChange:m,className:"w-full border rounded px-3 py-2 mb-4"}),(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Rol"}),(0,s.jsxs)("select",{name:"role",value:t.role,onChange:m,className:"w-full border rounded px-3 py-2 mb-4",children:[(0,s.jsx)("option",{value:"admin",children:"Admin"}),(0,s.jsx)("option",{value:"user",children:"Usuario"})]}),(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Email"}),(0,s.jsx)("input",{name:"email",type:"email",value:t.email,onChange:m,className:"w-full border rounded px-3 py-2 mb-4"}),(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Aplicaci\xf3n"}),(0,s.jsx)("input",{name:"applicationName",value:t.applicationName,onChange:m,className:"w-full border rounded px-3 py-2 mb-4"}),(0,s.jsxs)("label",{className:"flex items-center mb-4",children:[(0,s.jsx)("input",{type:"checkbox",name:"active",checked:t.active,onChange:m,className:"mr-2"}),"Usuario activo"]}),(0,s.jsx)("button",{onClick:()=>{let a=(0,l.l)(),s={id:a.length>0?Math.max(...a.map(e=>e.id))+1:1,...t};(0,l.m)([...a,s]),e.push("/dashboard/admin/users")},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Crear Usuario"})]})}},5013:(e,t,a)=>{"use strict";function s(e){l=e}function r(){return l}function n(){l=null}a.d(t,{Rj:()=>s,TW:()=>r,we:()=>n});let l=null;l=function(){let e=document.cookie.split(";").find(e=>e.trim().startsWith("auth_token="));if(!e)return null;try{let t=e.split("=")[1];return JSON.parse(atob(t))}catch(e){return null}}()},5471:(e,t,a)=>{"use strict";a.d(t,{J:()=>n});var s=a(9576);let r={admin:{canAccessUsers:!0,canCreateUsers:!0,canEditUsers:!0,canViewReports:!0,canAccessStock:!0},user:{canAccessUsers:!1,canCreateUsers:!1,canEditUsers:!1,canViewReports:!0,canAccessStock:!0}};function n(){let{user:e}=(0,s.A)(),t=null==e?void 0:e.role;return{hasPermission:e=>!!t&&r[t][e]}}},9428:(e,t,a)=>{Promise.resolve().then(a.bind(a,3637))},9576:(e,t,a)=>{"use strict";a.d(t,{A:()=>i,AuthProvider:()=>o});var s=a(5155),r=a(2115),n=a(5013);let l=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[a,o]=(0,r.useState)(null),[i,c]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{c(!0);let e=sessionStorage.getItem("user")||localStorage.getItem("user");e&&o(JSON.parse(e))},[]),(0,r.useEffect)(()=>{let e=()=>{let e=sessionStorage.getItem("user")||localStorage.getItem("user");o(e?JSON.parse(e):null)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),(0,s.jsxs)(l.Provider,{value:{user:a,setUser:o,logout:()=>{sessionStorage.removeItem("user"),localStorage.removeItem("user"),document.cookie="auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC",o(null),(0,n.we)(),window.location.href="".concat("/StockLogistica","/login")}},children:[i?t:null," "]})}function i(){let e=(0,r.useContext)(l);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[619,441,684,358],()=>t(9428)),_N_E=e.O()}]);
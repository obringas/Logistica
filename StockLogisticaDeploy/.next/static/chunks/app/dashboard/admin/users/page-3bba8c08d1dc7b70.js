(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[274],{457:(e,t,r)=>{"use strict";r.d(t,{l:()=>l,m:()=>o});var s=r(2109),a=r.n(s);let n=[{id:1,username:"admin",password:"admin123",role:"admin",active:!0,email:"",applicationName:"StockLogistica"},{id:2,username:"juan",password:"juan123",role:"user",active:!0,email:"",applicationName:"StockLogistica"}],c="users_secure",i="claveSegura123456";function l(){let e=localStorage.getItem(c);if(!e)return[...n];try{let t=a().AES.decrypt(e,i).toString(a().enc.Utf8);return JSON.parse(t)}catch(e){return console.warn("❌ Error al desencriptar usuarios, se cargan los iniciales"),[...n]}}function o(e){var t;let r=(t=JSON.stringify(e),a().AES.encrypt(t,i).toString());localStorage.setItem(c,r)}},477:()=>{},5013:(e,t,r)=>{"use strict";function s(e){c=e}function a(){return c}function n(){c=null}r.d(t,{Rj:()=>s,TW:()=>a,we:()=>n});let c=null;c=function(){let e=document.cookie.split(";").find(e=>e.trim().startsWith("auth_token="));if(!e)return null;try{let t=e.split("=")[1];return JSON.parse(atob(t))}catch(e){return null}}()},5471:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});var s=r(9576);let a={admin:{canAccessUsers:!0,canCreateUsers:!0,canEditUsers:!0,canViewReports:!0,canAccessStock:!0},user:{canAccessUsers:!1,canCreateUsers:!1,canEditUsers:!1,canViewReports:!0,canAccessStock:!0}};function n(){let{user:e}=(0,s.A)(),t=null==e?void 0:e.role;return{hasPermission:e=>!!t&&a[t][e]}}},5820:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(5155),a=r(2115),n=r(5695),c=r(457),i=r(5471),l=r(9576);function o(){let[e,t]=(0,a.useState)([]),[r,o]=(0,a.useState)(!0),d=(0,n.useRouter)(),{user:u}=(0,l.A)(),{hasPermission:m}=(0,i.J)();(0,a.useEffect)(()=>{if(!u){d.push("/login");return}if(!m("canAccessUsers")){d.push("/dashboard");return}t((0,c.l)()),o(!1)},[u]);let h=r=>{let s=e.map(e=>e.id===r?{...e,active:!e.active}:e);t(s),(0,c.m)(s)},p=r=>{let s=e.filter(e=>e.id!==r);t(s),(0,c.m)(s)};return r?(0,s.jsx)("p",{className:"text-center p-6",children:"Cargando..."}):(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Administraci\xf3n de Usuarios"}),(0,s.jsx)("div",{className:"flex justify-end mb-4",children:m("canCreateUsers")&&(0,s.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",onClick:()=>d.push("/dashboard/admin/users/create"),children:"Crear Usuario"})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full border border-gray-300 shadow-md rounded",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 border",children:"Usuario"}),(0,s.jsx)("th",{className:"p-2 border",children:"Email"}),(0,s.jsx)("th",{className:"p-2 border",children:"Rol"}),(0,s.jsx)("th",{className:"p-2 border",children:"Estado"}),(0,s.jsx)("th",{className:"p-2 border text-center",children:"Acciones"})]})}),(0,s.jsx)("tbody",{children:e.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"p-2 border",children:e.username}),(0,s.jsx)("td",{className:"p-2 border",children:e.email}),(0,s.jsx)("td",{className:"p-2 border",children:(0,s.jsx)("span",{className:"text-sm px-2 py-1 rounded-full ".concat("admin"===e.role?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-700"),children:e.role})}),(0,s.jsx)("td",{className:"p-2 border",children:e.active?(0,s.jsx)("span",{className:"text-green-700 font-medium",children:"Activo"}):(0,s.jsx)("span",{className:"text-red-700 font-medium",children:"Inactivo"})}),(0,s.jsxs)("td",{className:"p-2 border text-center space-x-2",children:[m("canEditUsers")&&(0,s.jsx)("button",{className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",onClick:()=>d.push("/dashboard/admin/users/edit/".concat(e.id)),children:"Editar"}),m("canEditUsers")&&(0,s.jsx)("button",{className:"bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600",onClick:()=>h(e.id),children:e.active?"Desactivar":"Activar"}),m("canEditUsers")&&(0,s.jsx)("button",{className:"bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700",onClick:()=>p(e.id),children:"Eliminar"})]})]},e.id))})]})})]})}},7286:(e,t,r)=>{Promise.resolve().then(r.bind(r,5820))},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,AuthProvider:()=>i});var s=r(5155),a=r(2115),n=r(5013);let c=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[l,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{o(!0);let e=sessionStorage.getItem("user")||localStorage.getItem("user");e&&i(JSON.parse(e))},[]),(0,a.useEffect)(()=>{let e=()=>{let e=sessionStorage.getItem("user")||localStorage.getItem("user");i(e?JSON.parse(e):null)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),(0,s.jsxs)(c.Provider,{value:{user:r,setUser:i,logout:()=>{sessionStorage.removeItem("user"),localStorage.removeItem("user"),document.cookie="auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC",i(null),(0,n.we)(),window.location.href="".concat("/StockLogistica","/login")}},children:[l?t:null," "]})}function l(){let e=(0,a.useContext)(c);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[619,441,684,358],()=>t(7286)),_N_E=e.O()}]);
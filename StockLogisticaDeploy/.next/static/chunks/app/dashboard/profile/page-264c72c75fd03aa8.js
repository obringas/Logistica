(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[399],{245:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(5155),n=r(5695),s=r(2115),i=r(5013),o=r(9959);function l(){let e=(0,n.useRouter)(),t=(0,i.TW)(),[r,l]=(0,s.useState)(!1),[c,u]=(0,s.useState)("");return t?(0,a.jsxs)("div",{className:"container mx-auto mt-8 p-6 bg-white shadow-md rounded",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Perfil del Usuario"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"ID de Usuario:"})," ",t.id]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"Nombre de Usuario:"})," ",t.username]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"Email:"})," ",t.email||"—"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"Rol:"})," ",t.role]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"Aplicaci\xf3n:"})," ",t.applicationName||"N/A"]})]})]}),"admin"!==t.role&&!r&&(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>l(!0),children:"✏️ Editar mis datos"}),"admin"!==t.role&&r&&(0,a.jsxs)("div",{className:"bg-gray-50 border p-4 rounded",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Editar contrase\xf1a"}),(0,a.jsx)("label",{className:"block text-gray-700 mb-1",children:"Nombre de usuario"}),(0,a.jsx)("input",{className:"w-full border px-3 py-2 rounded mb-3 bg-gray-100",value:t.username,readOnly:!0}),(0,a.jsx)("label",{className:"block text-gray-700 mb-1",children:"Nueva contrase\xf1a"}),(0,a.jsx)("input",{className:"w-full border px-3 py-2 rounded mb-4",type:"password",value:c,onChange:e=>u(e.target.value),placeholder:"********"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded",onClick:()=>{if(!c){alert("Debes ingresar una nueva contrase\xf1a.");return}(0,o.b6)(t.id,t.username,c),alert("Contrase\xf1a actualizada correctamente."),l(!1)},children:"Guardar cambios"}),(0,a.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded",onClick:()=>l(!1),children:"Cancelar"})]})]}),"admin"===t.role&&(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>e.push("/dashboard/admin/users"),className:"bg-purple-600 text-white px-4 py-2 rounded",children:"\uD83D\uDC64 Administrar usuarios"})})]}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Cargando usuario..."})}},457:(e,t,r)=>{"use strict";r.d(t,{l:()=>l,m:()=>c});var a=r(2109),n=r.n(a);let s=[{id:1,username:"admin",password:"admin123",role:"admin",active:!0,email:"",applicationName:"StockLogistica"},{id:2,username:"juan",password:"juan123",role:"user",active:!0,email:"",applicationName:"StockLogistica"}],i="users_secure",o="claveSegura123456";function l(){let e=localStorage.getItem(i);if(!e)return[...s];try{let t=n().AES.decrypt(e,o).toString(n().enc.Utf8);return JSON.parse(t)}catch(e){return console.warn("❌ Error al desencriptar usuarios, se cargan los iniciales"),[...s]}}function c(e){var t;let r=(t=JSON.stringify(e),n().AES.encrypt(t,o).toString());localStorage.setItem(i,r)}},477:()=>{},3376:(e,t,r)=>{Promise.resolve().then(r.bind(r,245))},5013:(e,t,r)=>{"use strict";function a(e){i=e}function n(){return i}function s(){i=null}r.d(t,{Rj:()=>a,TW:()=>n,we:()=>s});let i=null;i=function(){let e=document.cookie.split(";").find(e=>e.trim().startsWith("auth_token="));if(!e)return null;try{let t=e.split("=")[1];return JSON.parse(atob(t))}catch(e){return null}}()},5342:(e,t,r)=>{"use strict";r.d(t,{N2:()=>n,VX:()=>s,Zl:()=>i});var a=r(9959);function n(){let e=function(){let e=document.cookie.match(RegExp("(^| )auth_token=([^;]+)"));return e?e[2]:null}();if(!e)return!1;let t=function(e){try{let t=e.split(".")[1];return JSON.parse(atob(t))}catch(e){return console.error("Error al decodificar JWT:",e),null}}(e);if(!(null==t?void 0:t.exp))return!1;let r=1e3*t.exp;return Date.now()<r}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,r=new Date(Date.now()+6e4*t);document.cookie="auth_token=".concat(e,"; path=/; expires=").concat(r.toUTCString(),"; secure; SameSite=Strict")}function i(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15,r=()=>{console.log("⏰ Sesi\xf3n cerrada por inactividad"),(0,a.ri)()},n=()=>{clearTimeout(e),e=setTimeout(r,6e4*t)};return window.addEventListener("mousemove",n),window.addEventListener("keydown",n),window.addEventListener("click",n),n(),()=>{clearTimeout(e),window.removeEventListener("mousemove",n),window.removeEventListener("keydown",n),window.removeEventListener("click",n)}}},9959:(e,t,r)=>{"use strict";r.d(t,{NM:()=>i,b6:()=>l,ri:()=>o}),r(2109);var a=r(5013),n=r(457),s=r(5342);async function i(e,t){let r=(0,n.l)().find(r=>r.username===e&&r.password===t);if(r){let e=function(e){let t=e=>btoa(JSON.stringify(e)).replace(/=/g,"");return"".concat(t({alg:"HS256",typ:"JWT"}),".").concat(t(e),".signature")}({userId:r.id,userName:r.username,role:r.role||"user",exp:Math.floor(Date.now()/1e3)+900}),t={userId:r.id,userName:r.username,role:r.role||"user",token:e};return localStorage.setItem("user",JSON.stringify(t)),(0,a.Rj)(t),(0,s.VX)(t.token),!0}return!1}function o(){document.cookie="auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC",sessionStorage.removeItem("user"),localStorage.removeItem("user"),(0,a.we)(),window.location.href="".concat("/StockLogistica","/login")}function l(e,t,r){let s=(0,n.l)().map(a=>a.id===e?{...a,username:t,password:r}:a);(0,n.m)(s);let i=s.find(t=>t.id===e);if(i){let e={userId:i.id,userName:i.username,role:i.role,token:"",applicationName:"Local"};localStorage.setItem("authUser",JSON.stringify(e)),(0,a.Rj)(e)}}}},e=>{var t=t=>e(e.s=t);e.O(0,[619,441,684,358],()=>t(3376)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[10],{2383:()=>{},2408:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>x});var t=s(5155),l=s(2115);let r=[2017,2018,2019,2020,2021,2022,2023,2024,2025],d=[{id:0,codigo:0,descripcion:"Todos"},{id:1,codigo:6,descripcion:"Fardito"},{id:2,codigo:100,descripcion:"Lamina"},{id:3,codigo:200,descripcion:"Scrap Grande"},{id:4,codigo:300,descripcion:"Scrap Chico"},{id:5,codigo:400,descripcion:"Palo Largo"},{id:6,codigo:500,descripcion:"Palo Mezcla"},{id:7,codigo:600,descripcion:"Palo Corto"},{id:8,codigo:900,descripcion:"Fibra"},{id:9,codigo:1e3,descripcion:"Tabaco Importado"},{id:10,codigo:9999,descripcion:"SIN TIPO PRODUCTO"}];function o(e){let{filters:a,onChange:s,onSubmit:o,loading:c}=e,[n,i]=(0,l.useState)([{id:0,nombre:"Todos"}]),{grados:x,fetchGrados:p}=function(){let[e,a]=(0,l.useState)([]),[s,t]=(0,l.useState)(!1);return{grados:e,fetchGrados:async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;t(!0);try{let t=await fetch("/StockLogistica/api/stock/get-grados",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campania:e,idPropietario:s})}),l=await t.json();a(l)}catch(e){console.error("Error al obtener grados:",e),a([])}finally{t(!1)}},loading:s}}(),h=e=>{let{name:t,value:l}=e.target;s({...a,[t]:Number(l)})};return(0,l.useEffect)(()=>{a.codCampania&&p(a.codCampania,3)},[a.codCampania]),(0,l.useEffect)(()=>{i([{id:0,nombre:"Todos"},...x.map(e=>({id:e.idGradoMarca,nombre:e.nombreGradoMarca}))]),(void 0===a.idGrado||null===a.idGrado)&&s({...a,idGrado:0})},[x]),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-300 mb-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-1",children:"Campa\xf1a"}),(0,t.jsx)("select",{name:"codCampania",value:a.codCampania,onChange:h,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm",children:r.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-1",children:"Producto"}),(0,t.jsx)("select",{name:"idProducto",value:a.idProducto,onChange:h,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm",children:d.map(e=>(0,t.jsx)("option",{value:e.id,children:e.descripcion},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-1",children:"Grado"}),(0,t.jsx)("select",{name:"idGrado",value:a.idGrado,onChange:h,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm",children:n.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombre},"grado-".concat(e.id)))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-1",children:"Caja Desde"}),(0,t.jsx)("input",{type:"number",name:"cajaDesde",value:a.cajaDesde,onChange:h,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-1",children:"Caja Hasta"}),(0,t.jsx)("input",{type:"number",name:"cajaHasta",value:a.cajaHasta,onChange:h,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-1",children:"Nro de Cata"}),(0,t.jsx)("input",{type:"number",name:"nroCataBuscar",value:a.nroCataBuscar,onChange:h,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"})]})]}),(0,t.jsx)("div",{className:"mt-6 text-right",children:(0,t.jsx)("button",{onClick:o,disabled:c,className:"px-5 py-2 rounded-lg text-sm font-semibold text-white ".concat(c?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:c?"Consultando...":"Buscar"})})]})}var c=s(3925);function n(e){let{detalle:a,loading:s,onClose:r}=e,[d,o]=(0,l.useState)(1);if(s)return(0,t.jsx)("div",{className:"text-blue-600",children:"Cargando detalle..."});let n=(d-1)*10,i=a.slice(n,n+10),x=Math.ceil(a.length/10);return(0,t.jsxs)("div",{className:"mt-6 bg-gray-100 p-4 rounded-lg shadow",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg",children:"Detalle de Stock"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>{let e=c.Wp.json_to_sheet(a),s=c.Wp.book_new();c.Wp.book_append_sheet(s,e,"Detalle"),c._h(s,"detalle_stock.xlsx")},className:"bg-green-600 text-white px-3 py-1 rounded mr-2",children:"\uD83D\uDCE4 Exportar"}),(0,t.jsx)("button",{onClick:r,className:"bg-red-500 text-white px-3 py-1 rounded",children:"❌ Cerrar"})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm text-left bg-white",children:[(0,t.jsx)("thead",{className:"bg-gray-200 text-xs uppercase font-semibold",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-2 py-1",children:"Grado"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Campa\xf1a"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"CATA"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Boleta DGI"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Bulto"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Dep\xf3sito"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Galp\xf3n"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Estiba"})]})}),(0,t.jsx)("tbody",{children:i.map((e,a)=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-2 py-1",children:e.nombreGradoMarca}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.campania}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.nroCATA}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.boletaDGI}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.nroBulto}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.deposito}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.galpon}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.estiba})]},a))})]})}),x>1&&(0,t.jsx)("div",{className:"flex justify-center mt-3 gap-2",children:Array.from({length:x},(e,a)=>(0,t.jsx)("button",{onClick:()=>o(a+1),className:"px-3 py-1 border rounded ".concat(d===a+1?"bg-blue-500 text-white":"bg-white"),children:a+1},a))})]})}function i(e){let{data:a,loading:s}=e,[r,d]=(0,l.useState)(1),[o,i]=(0,l.useState)(!1),[x,p]=(0,l.useState)(null),{detalle:h,fetchDetalle:m,loading:u}=function(){let[e,a]=(0,l.useState)([]),[s,t]=(0,l.useState)(!1);return{detalle:e,fetchDetalle:async e=>{t(!0);try{let s=await fetch("/StockLogistica/api/stock/detalle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idGrado:e,idGalpon:0,idEstiba:0,idEstado:0,idVariedad:0,idProducto:0,idPropietario:0,nroBultoDesde:0,nroBultoHasta:0,nroCata:0})}),t=await s.json();Array.isArray(t)?a(t):(console.error("⚠️ La respuesta del backend no es un array:",t),a([]))}catch(e){console.error("Error al obtener detalle:",e),a([])}finally{t(!1)}},loading:s}}(),b=async e=>{p(e),await m(e),i(!0)};if(s)return(0,t.jsx)("div",{className:"text-center text-blue-600",children:"\uD83D\uDD04 Cargando..."});if(!a||0===a.length)return(0,t.jsx)("div",{className:"text-center text-gray-500",children:"No hay resultados."});let j=(r-1)*10,g=a.slice(j,j+10),y=Math.ceil(a.length/10);return(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,t.jsxs)("span",{children:["Resultados: ",a.length]}),(0,t.jsx)("button",{onClick:()=>{if(!a)return;let e=c.Wp.json_to_sheet(a),s=c.Wp.book_new();c.Wp.book_append_sheet(s,e,"Stock"),c._h(s,"reporte_stock.xlsx")},className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded",children:"\uD83D\uDCE4 Exportar a Excel"})]}),(0,t.jsx)("div",{className:"overflow-x-auto border rounded shadow",children:(0,t.jsxs)("table",{className:"min-w-full text-sm text-left text-gray-700 bg-white",children:[(0,t.jsx)("thead",{className:"bg-gray-100 text-xs uppercase font-medium text-gray-600",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-2 py-1",children:"\uD83D\uDD0D"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Producto"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Variedad"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Grado"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Galp\xf3n"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Estiba"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Cant. Cajas"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Rango Cajas"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Kilos"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Tara"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Estado"}),(0,t.jsx)("th",{className:"px-2 py-1",children:"Propietario"})]})}),(0,t.jsx)("tbody",{children:g.map((e,a)=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-2 py-1 text-center",children:(0,t.jsx)("button",{onClick:()=>b(e.id_gradoMarca),className:"text-blue-600 hover:text-blue-800",children:"\uD83D\uDD0D"})}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.tipoProducto}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.variedad}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.nombreGradoMarca}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.nombreGalpon}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.nombreEstiba}),(0,t.jsx)("td",{className:"px-2 py-1 text-center",children:e.cantidadCajas}),(0,t.jsx)("td",{className:"px-2 py-1 text-center",children:e.rangoCajas}),(0,t.jsx)("td",{className:"px-2 py-1 text-right",children:e.kilosTotales.toFixed(2)}),(0,t.jsx)("td",{className:"px-2 py-1 text-right",children:e.tara.toFixed(2)}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.nombreEstado}),(0,t.jsx)("td",{className:"px-2 py-1",children:e.propietarioNombre})]},a))})]})}),(0,t.jsx)("div",{className:"flex justify-center mt-3 gap-2",children:Array.from({length:y},(e,a)=>(0,t.jsx)("button",{onClick:()=>d(a+1),className:"px-3 py-1 border rounded ".concat(r===a+1?"bg-blue-500 text-white":"bg-white"),children:a+1},a))}),o&&null!==x&&(0,t.jsx)(n,{detalle:h,loading:u,onClose:()=>i(!1)})]})}function x(){let[e,a]=(0,l.useState)({idAdministrador:3,idGrado:0,cajaDesde:0,cajaHasta:0,idGalpon:0,idEstiba:0,idProducto:0,codCampania:2025,nroCataBuscar:0}),[s,r]=(0,l.useState)([]),[d,c]=(0,l.useState)(!1),{fetchStockData:n}=function(){let[e,a]=(0,l.useState)(null);return{fetchStockData:async e=>{try{let a=await fetch("/StockLogistica/api/stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("Error al consultar el stock.");return await a.json()}catch(e){return console.error("\uD83D\uDD34 Error en fetchStock:",e),a(e.message||"Error desconocido"),null}},error:e}}(),x=async()=>{c(!0);try{console.log("\uD83D\uDFE1 Ejecutando b\xfasqueda con filtros:",e);let a=await n(e);r(null!=a?a:[])}finally{c(!1)}};return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Stock Actual"}),(0,t.jsx)(o,{filters:e,onChange:a,onSubmit:x,loading:d}),(0,t.jsx)(i,{data:s,loading:d})]})}},3686:()=>{},8170:(e,a,s)=>{Promise.resolve().then(s.bind(s,2408))}},e=>{var a=a=>e(e.s=a);e.O(0,[524,441,684,358],()=>a(8170)),_N_E=e.O()}]);